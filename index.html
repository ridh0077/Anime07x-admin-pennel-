<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime07x | Ultimate Admin V2</title>
    
    <!-- Firebase & Icons -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #AFE607; /* Lime Green */
            --secondary: #8cb806; /* Darker Lime */
            --accent: #ffffff; 
            --bg: #0E0E0B; /* Dark Grey Background */
            --card: #181814; /* Slightly lighter grey for cards */
            --glass: rgba(175, 230, 7, 0.05); /* Lime glass effect */
            --border: rgba(255, 255, 255, 0.08);
            --grad: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        /* Global Reset & Removal of Blue Tap Shadow */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Outfit', sans-serif; 
            -webkit-tap-highlight-color: transparent; /* Removes blue tap shadow on mobile */
            outline: none !important; /* Removes browser default focus outline */
        }
        
        body { 
            background: var(--bg); 
            color: #fff; 
            overflow-x: hidden; 
            background-image: radial-gradient(circle at top right, rgba(175, 230, 7, 0.08), transparent); 
            min-height: 100vh;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }

        /* Toast Notification */
        #custom-toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: #1a1a1a; backdrop-filter: blur(15px);
            border: 1px solid var(--primary); color: #fff; padding: 15px 25px;
            border-radius: 15px; z-index: 10000; box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); display: flex; align-items: center; gap: 12px;
        }
        #custom-toast.show { transform: translateX(-50%) translateY(0); }
        #custom-toast i { color: var(--primary); }

        /* Header & Sidebar */
        .header { 
            height: 70px; background: rgba(14, 14, 11, 0.9); backdrop-filter: blur(10px); 
            border-bottom: 1px solid var(--border); display: flex; align-items: center; 
            justify-content: space-between; padding: 0 25px; position: fixed; top: 0; width: 100%; z-index: 2000;
        }
        .header h2 { font-size: 22px; color: var(--primary); font-weight: 800; letter-spacing: 1px; }
        .header h2 span { color: #fff; opacity: 0.7; font-weight: 300; font-size: 14px; margin-left: 5px; }
        
        .menu-btn { background: var(--glass); border: 1px solid var(--primary); color: var(--primary); width: 40px; height: 40px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; }

        .sidebar { 
            position: fixed; left: 0; top: 0; width: 280px; height: 100%; 
            background: rgba(14, 14, 11, 0.98); backdrop-filter: blur(15px); 
            border-right: 1px solid var(--border); z-index: 2500; 
            transform: translateX(-101%); transition: 0.3s; padding: 100px 20px 20px 20px;
        }
        .sidebar.open { transform: translateX(0); }

        .nav-link { 
            display: flex; align-items: center; gap: 15px; padding: 15px; border-radius: 15px; 
            color: rgba(255,255,255,0.6); text-decoration: none; margin-bottom: 10px; transition: 0.2s; 
            cursor: pointer; border: 1px solid transparent; 
        }
        .nav-link:hover { color: var(--primary); background: var(--glass); }
        .nav-link.active { background: var(--primary); color: #000; font-weight: 700; box-shadow: 0 4px 15px rgba(175, 230, 7, 0.3); }
        .nav-link.active i { color: #000; text-shadow: none; }

        /* Main Content */
        .main { padding: 100px 20px 40px 20px; max-width: 1200px; margin: 0 auto; transition: 0.3s; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2100; display: none; backdrop-filter: blur(3px); }

        /* Dashboard Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: var(--card); border: 1px solid var(--border); padding: 20px; border-radius: 20px; text-align: center; position: relative; overflow: hidden; }
        .stat-card::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 4px; background: var(--grad); }
        .stat-card h4 { font-size: 12px; opacity: 0.6; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .stat-card p { font-size: 32px; font-weight: 800; color: var(--primary); }

        /* Panels */
        .glass-panel { background: var(--card); border: 1px solid var(--border); border-radius: 25px; padding: 25px; margin-bottom: 30px; display: none; animation: fadeIn 0.4s ease; }
        .glass-panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-size: 13px; font-weight: 600; color: #fff; opacity: 0.7; text-transform: uppercase; }
        input, select, textarea { width: 100%; padding: 14px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 12px; color: #fff; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--primary); background: rgba(175, 230, 7, 0.05); }

        /* Preview Box */
        .preview-box { margin-top: 10px; border-radius: 15px; overflow: hidden; border: 1px solid var(--primary); display: none; background: #000; }
        .poster-preview { width: 100%; aspect-ratio: 2/3; object-fit: cover; }
        .backdrop-preview { width: 100%; aspect-ratio: 16/9; object-fit: cover; }

        /* Dropdown Custom */
        .custom-dropdown { position: relative; width: 100%; }
        .dropdown-selected { width: 100%; padding: 14px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 12px; color: #fff; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .dropdown-options { position: absolute; top: 100%; left: 0; width: 100%; background: #151512; border: 1px solid var(--primary); border-radius: 12px; z-index: 100; display: none; margin-top: 5px; max-height: 200px; overflow-y: auto; }
        .dropdown-options div { padding: 12px; cursor: pointer; transition: 0.2s; border-bottom: 1px solid rgba(255,255,255,0.02); }
        .dropdown-options div:hover { background: var(--primary); color: #000; }
        .custom-dropdown.open .dropdown-options { display: block; }

        /* Genre Selector */
        .genre-selector { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); 
            gap: 10px; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 15px; border: 1px solid var(--border); 
        }
        .genre-option { display: flex; align-items: center; gap: 8px; font-size: 12px; cursor: pointer; }
        .genre-option input { width: 18px; height: 18px; accent-color: var(--primary); }

        .btn-grad { background: var(--grad); border: none; padding: 16px; border-radius: 12px; color: #000; font-weight: 800; cursor: pointer; width: 100%; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px; }
        .btn-grad:hover { filter: brightness(1.1); transform: translateY(-2px); box-shadow: 0 5px 20px rgba(175, 230, 7, 0.4); }

        /* Search Bar for Lists */
        .search-container { position: relative; margin-bottom: 15px; }
        .search-container i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--primary); }
        .search-container input { padding-left: 45px; background: rgba(255,255,255,0.03); border-radius: 30px; }

        /* List Styling */
        .view-switcher-container { display: flex; gap: 8px; margin-bottom: 20px; background: rgba(255,255,255,0.03); padding: 5px; border-radius: 15px; }
        .view-tab { flex: 1; text-align: center; padding: 10px; border-radius: 10px; font-size: 11px; font-weight: 800; color: #666; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        .view-tab.active { background: var(--primary); color: #000; }

        .items-list-container { display: grid; gap: 15px; }
        
        /* Layout Detailed */
        .list-detailed .item-row { background: rgba(255,255,255,0.02); border: 1px solid var(--border); padding: 15px; border-radius: 20px; display: flex; gap: 20px; align-items: center; }
        .list-detailed .item-thumb { width: 80px; height: 110px; border-radius: 12px; object-fit: cover; border: 1px solid rgba(175, 230, 7, 0.2); }
        .list-detailed .item-info-box { flex: 1; }
        .list-detailed .item-title-text { font-size: 16px; font-weight: 700; margin-bottom: 5px; display: block; color: var(--primary); }
        .list-detailed .item-category-tag { font-size: 10px; background: rgba(255, 255, 255, 0.1); color: #fff; padding: 4px 10px; border-radius: 6px; font-weight: 800; }

        /* Layout Compact */
        .list-compact .item-row { background: rgba(255,255,255,0.02); border: 1px solid var(--border); padding: 10px 15px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; }
        .list-compact .item-thumb { width: 40px; height: 55px; border-radius: 8px; object-fit: cover; }
        .list-compact .item-title-text { font-size: 14px; flex: 1; margin: 0 15px; color: var(--primary); }

        /* Layout Grid */
        .list-grid { grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .list-grid .item-row { background: rgba(255,255,255,0.02); border: 1px solid var(--border); padding: 8px; border-radius: 12px; text-align: center; }
        .list-grid .item-thumb { width: 100%; aspect-ratio: 2/3; border-radius: 8px; object-fit: cover; margin-bottom: 8px; }
        .list-grid .item-title-text { font-size: 10px; height: 25px; overflow: hidden; margin-bottom: 8px; color: var(--primary); }
        .list-grid .action-btns { justify-content: center; gap: 5px; }
        .list-grid .edit-btn, .list-grid .del-btn { width: 30px; height: 30px; font-size: 12px; }

        .action-btns { display: flex; gap: 10px; }
        .del-btn, .edit-btn { width: 38px; height: 38px; border-radius: 10px; cursor: pointer; border: none; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .del-btn { background: rgba(255, 77, 77, 0.1); color: #ff4d4d; border: 1px solid rgba(255, 77, 77, 0.2); }
        .edit-btn { background: rgba(175, 230, 7, 0.1); color: var(--primary); border: 1px solid rgba(175, 230, 7, 0.2); }
        .del-btn:hover { background: #ff4d4d; color: #fff; }
        .edit-btn:hover { background: var(--primary); color: #000; }

        /* Episode Row Label Styling */
        .ep-row label { font-size: 11px; color: var(--primary); margin-bottom: 4px; display: block; font-weight: bold;}

        /* Modal Delete */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); z-index: 5000; display: none; align-items: center; justify-content: center; }
        .confirm-box { background: var(--card); border: 1px solid var(--primary); padding: 30px; border-radius: 25px; text-align: center; width: 90%; max-width: 350px; animation: popIn 0.3s ease; }
        @keyframes popIn { from { transform: scale(0.8); } to { transform: scale(1); } }

        @media (min-width: 1100px) {
            .sidebar { transform: translateX(0); background: rgba(14,14,11,0.6); }
            .main { margin-left: 300px; }
            .menu-btn, .overlay { display: none !important; }
        }

        @media (max-width: 600px) {
            .list-grid { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>

    <div id="custom-toast"></div>

    <div class="modal-overlay" id="delModal">
        <div class="confirm-box">
            <i class="fas fa-exclamation-triangle" style="font-size: 50px; color: #ff4d4d; margin-bottom: 15px;"></i>
            <h3>Delete Content?</h3>
            <p style="opacity:0.6; font-size:14px; margin: 10px 0 20px;">This item will be permanently removed from user app.</p>
            <div style="display: flex; gap: 10px;">
                <button onclick="closeDelModal()" style="flex:1; padding:12px; border-radius:12px; background:var(--glass); color:#fff; border:1px solid var(--border); cursor:pointer;">Cancel</button>
                <button id="confirmDelBtn" style="flex:1; padding:12px; border-radius:12px; background:#ff4d4d; color:#fff; border:none; font-weight:bold; cursor:pointer;">Confirm</button>
            </div>
        </div>
    </div>

    <div class="header">
        <div class="logo-area" style="display:flex; align-items:center; gap:15px;">
            <button class="menu-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
            <h2>ANIME07X <span>ULTIMATE ADMIN</span></h2>
        </div>
        <div id="online-status" style="font-size: 11px; color: var(--primary); font-weight: 800; background: rgba(175, 230, 7, 0.1); padding: 5px 12px; border-radius: 20px;"><i class="fas fa-circle" style="font-size: 8px; vertical-align: middle; margin-right: 5px;"></i> LIVE</div>
    </div>

    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <div class="sidebar" id="sidebar">
        <div class="nav-link active" onclick="showSec('dashboard-sec', this)"><i class="fas fa-chart-pie"></i> Dashboard</div>
        <div class="nav-link" onclick="showSec('movie-sec', this)"><i class="fas fa-film"></i> Movies Manager</div>
        <div class="nav-link" onclick="showSec('series-sec', this)"><i class="fas fa-tv"></i> Series Manager</div>
        <div class="nav-link" onclick="showSec('live-sec', this)"><i class="fas fa-broadcast-tower"></i> Live TV</div>
        <div class="nav-link" onclick="showSec('notify-sec', this)"><i class="fas fa-bell"></i> Push Notification</div>
        <div class="nav-link" onclick="showSec('setting-sec', this)"><i class="fas fa-sliders"></i> App Control</div>
    </div>

    <div class="main">
        <!-- Dashboard Section -->
        <div id="dashboard-sec" class="glass-panel active">
            <h3 style="margin-bottom: 20px;">Platform Overview</h3>
            <div class="stats-grid">
                <div class="stat-card"><h4>Total Movies</h4><p id="count-movies">0</p></div>
                <div class="stat-card"><h4>Total Series</h4><p id="count-series">0</p></div>
                <div class="stat-card"><h4>Live Channels</h4><p id="count-live">0</p></div>
                <div class="stat-card"><h4>App Version</h4><p id="stat-version">1.0</p></div>
            </div>
            
            <div style="background: rgba(255,255,255,0.01); padding: 25px; border-radius: 20px; border: 1px solid var(--border);">
                <h4 style="color: var(--primary); margin-bottom: 10px;">Quick Actions</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                    <button class="btn-grad" style="padding: 12px; font-size: 12px;" onclick="showSec('movie-sec')">Upload Movie</button>
                    <button class="btn-grad" style="padding: 12px; font-size: 12px; background: #fff;" onclick="showSec('series-sec')">Upload Series</button>
                </div>
            </div>
        </div>

        <!-- Movie Section -->
        <div id="movie-sec" class="glass-panel">
            <h3 style="margin-bottom:20px; color:var(--primary)"><i class="fas fa-plus-circle"></i> Movie Editor</h3>
            <div class="form-group">
                <label>Movie Title / TMDb ID</label>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="m-title" placeholder="Search Title or Paste TMDb ID...">
                    <button onclick="fetchTMDB('movie')" style="background:var(--primary); color:#000; border:none; padding:0 20px; border-radius:10px; font-weight:bold; cursor:pointer;">FETCH</button>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label>Poster (2:3)</label>
                    <input type="text" id="m-poster" oninput="updatePreview('m-poster', 'm-poster-pre')">
                    <div class="preview-box" id="m-poster-pre"><img src="" class="poster-preview"></div>
                </div>
                <div class="form-group">
                    <label>Backdrop (16:9)</label>
                    <input type="text" id="m-backdrop" oninput="updatePreview('m-backdrop', 'm-backdrop-pre')">
                    <div class="preview-box" id="m-backdrop-pre"><img src="" class="backdrop-preview"></div>
                </div>
            </div>

            <div class="form-group">
                <label>Main Category</label>
                <div class="custom-dropdown" id="m-cat-dropdown">
                    <div class="dropdown-selected" onclick="toggleDropdown('m-cat-dropdown')">
                        <span id="m-cat-label">Hollywood</span><i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="dropdown-options">
                        <div onclick="selectOption('m-cat-dropdown', 'Hollywood')">Hollywood</div>
                        <div onclick="selectOption('m-cat-dropdown', 'Bollywood')">Bollywood</div>
                        <div onclick="selectOption('m-cat-dropdown', 'South Indian')">South Indian</div>
                        <div onclick="selectOption('m-cat-dropdown', 'Korean')">Korean</div>
                        <div onclick="selectOption('m-cat-dropdown', 'Anime')">Anime</div>
                        <div onclick="selectOption('m-cat-dropdown', 'Cartoon')">Cartoon</div>
                        <div onclick="selectOption('m-cat-dropdown', '18+')">18+ Content</div>
                    </div>
                    <input type="hidden" id="m-cat" value="Hollywood">
                </div>
            </div>
            
            <div class="form-group">
                <label>Sub-Genres</label>
                <div class="genre-selector" id="m-genres-list">
                    <label class="genre-option"><input type="checkbox" value="Action"> Action</label>
                    <label class="genre-option"><input type="checkbox" value="Adventure"> Adventure</label>
                    <label class="genre-option"><input type="checkbox" value="Comedy"> Comedy</label>
                    <label class="genre-option"><input type="checkbox" value="Horror"> Horror</label>
                    <label class="genre-option"><input type="checkbox" value="Romance"> Romance</label>
                    <label class="genre-option"><input type="checkbox" value="Thriller"> Thriller</label>
                    <label class="genre-option"><input type="checkbox" value="Drama"> Drama</label>
                    <label class="genre-option"><input type="checkbox" value="Sci-Fi"> Sci-Fi</label>
                </div>
            </div>

            <div class="form-group"><label>Direct Video Stream Link</label><input type="text" id="m-link" placeholder="m3u8, mp4, etc."></div>
            <button class="btn-grad" id="m-btn" onclick="saveMovie()">Upload Movie</button>

            <div style="margin-top: 40px;">
                <div class="search-container"><i class="fas fa-search"></i><input type="text" id="m-search" placeholder="Search from uploaded movies..." oninput="filterList('m-list', this.value)"></div>
                <div class="view-switcher-container">
                    <div class="view-tab active" id="btn-detailed-movie" onclick="switchView('detailed', 'movie')">Detailed</div>
                    <div class="view-tab" id="btn-compact-movie" onclick="switchView('compact', 'movie')">Compact</div>
                    <div class="view-tab" id="btn-grid-movie" onclick="switchView('grid', 'movie')">Grid</div>
                </div>
                <div id="m-list" class="items-list-container list-detailed"></div>
            </div>
        </div>

        <!-- Series Section -->
        <div id="series-sec" class="glass-panel">
            <h3 style="margin-bottom:20px; color:var(--primary)"><i class="fas fa-plus-circle"></i> Series Editor</h3>
            <div class="form-group">
                <label>Series Title / TMDb ID</label>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="s-title" placeholder="Search Title or Paste TMDb ID...">
                    <button onclick="fetchTMDB('series')" style="background:var(--primary); color:#000; border:none; padding:0 20px; border-radius:10px; font-weight:bold; cursor:pointer;">FETCH</button>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label>Poster URL</label>
                    <input type="text" id="s-poster" oninput="updatePreview('s-poster', 's-poster-pre')">
                    <div class="preview-box" id="s-poster-pre"><img src="" class="poster-preview"></div>
                </div>
                <div class="form-group">
                    <label>Backdrop URL</label>
                    <input type="text" id="s-backdrop" oninput="updatePreview('s-backdrop', 's-backdrop-pre')">
                    <div class="preview-box" id="s-backdrop-pre"><img src="" class="backdrop-preview"></div>
                </div>
            </div>

            <div class="form-group">
                <label>Category</label>
                <div class="custom-dropdown" id="s-cat-dropdown">
                    <div class="dropdown-selected" onclick="toggleDropdown('s-cat-dropdown')">
                        <span id="s-cat-label">Web Series</span><i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="dropdown-options">
                        <div onclick="selectOption('s-cat-dropdown', 'Web Series')">Web Series</div>
                        <div onclick="selectOption('s-cat-dropdown', 'Anime')">Anime</div>
                        <div onclick="selectOption('s-cat-dropdown', 'K-Drama')">K-Drama</div>
                        <div onclick="selectOption('s-cat-dropdown', 'C-Drama')">C-Drama</div>
                        <div onclick="selectOption('s-cat-dropdown', 'J-Drama')">J-Drama</div>
                        <div onclick="selectOption('s-cat-dropdown', 'Cartoon')">Cartoon</div>
                        <div onclick="selectOption('s-cat-dropdown', 'Mature')">Mature (18+)</div>
                    </div>
                    <input type="hidden" id="s-cat" value="Web Series">
                </div>
            </div>

            <div class="form-group">
                <label>Select Genres</label>
                <div class="genre-selector" id="s-genres-list">
                    <label class="genre-option"><input type="checkbox" value="Action"> Action</label>
                    <label class="genre-option"><input type="checkbox" value="Adventure"> Adventure</label>
                    <label class="genre-option"><input type="checkbox" value="Romance"> Romance</label>
                    <label class="genre-option"><input type="checkbox" value="Drama"> Drama</label>
                    <label class="genre-option"><input type="checkbox" value="Sci-Fi"> Sci-Fi</label>
                    <label class="genre-option"><input type="checkbox" value="Thriller"> Thriller</label>
                    <label class="genre-option"><input type="checkbox" value="Horror"> Horror</label>
                    <label class="genre-option"><input type="checkbox" value="Comedy"> Comedy</label>
                </div>
            </div>

            <div id="ep-list-admin" style="margin-top: 20px;"><label>Manage Episodes</label></div>
            <button onclick="addEpField()" style="background:rgba(175, 230, 7, 0.05); border:1px dashed var(--primary); color:var(--primary); padding:15px; width:100%; border-radius:12px; cursor:pointer; margin:10px 0; font-weight:bold;">+ ADD NEW EPISODE</button>
            <button class="btn-grad" id="s-btn" onclick="saveSeries()">Publish Web Series</button>

            <div style="margin-top: 40px;">
                <div class="search-container"><i class="fas fa-search"></i><input type="text" id="s-search" placeholder="Find uploaded series..." oninput="filterList('s-list', this.value)"></div>
                <div class="view-switcher-container">
                    <div class="view-tab active" id="btn-detailed-series" onclick="switchView('detailed', 'series')">Detailed</div>
                    <div class="view-tab" id="btn-compact-series" onclick="switchView('compact', 'series')">Compact</div>
                    <div class="view-tab" id="btn-grid-series" onclick="switchView('grid', 'series')">Grid</div>
                </div>
                <div id="s-list" class="items-list-container list-detailed"></div>
            </div>
        </div>

        <!-- Live Section -->
        <div id="live-sec" class="glass-panel">
            <h3 style="margin-bottom:20px; color:var(--primary)">Live TV Dashboard</h3>
            <div class="form-group"><label>Channel Name</label><input type="text" id="l-name"></div>
            <div class="form-group"><label>Logo URL</label><input type="text" id="l-logo"></div>
            <div class="form-group"><label>Stream Link (M3U8)</label><input type="text" id="l-link"></div>
            <button class="btn-grad" id="l-btn" onclick="saveLive()">Add Channel</button>
            
            <div id="l-list" class="items-list-container list-compact" style="margin-top: 30px;"></div>
        </div>

        <!-- Notification Section -->
        <div id="notify-sec" class="glass-panel">
            <h3 style="margin-bottom:20px; color:var(--primary)">Global Push Alert</h3>
            <div class="form-group"><label>Alert Message</label><textarea id="notif-msg" rows="4" placeholder="Hello users, new movie added!"></textarea></div>
            <div class="form-group"><label>Duration (Seconds)</label><input type="number" id="notif-dur" value="5"></div>
            <button class="btn-grad" onclick="sendNotification()">Send To All Users</button>
        </div>

        <!-- Settings -->
        <div id="setting-sec" class="glass-panel">
            <h3 style="margin-bottom:20px; color:var(--primary)">App Core Settings</h3>
            <div class="form-group"><label>App Version Name</label><input type="text" id="app-v" placeholder="e.g. 2.0.4"></div>
            <div class="form-group"><label>Telegram Link</label><input type="text" id="tg-link" placeholder="https://t.me/..."></div>
            <div class="form-group"><label>App Maintenance</label>
                <select id="app-maint">
                    <option value="false">Live (Normal)</option>
                    <option value="true">Maintenance Mode (App Locked)</option>
                </select>
            </div>
            <button class="btn-grad" onclick="saveSettings()">Apply Global Changes</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAwc9eWzT9OYOCe8hab2ouivQsyEgu2doE",
            authDomain: "anime07x-c77ba.firebaseapp.com",
            databaseURL: "https://anime07x-c77ba-default-rtdb.firebaseio.com",
            projectId: "anime07x-c77ba",
            storageBucket: "anime07x-c77ba.firebasestorage.app",
            messagingSenderId: "869262301806",
            appId: "1:869262301806:web:887cfd924ac0b8b451e47f"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const TMDB_API_KEY = "deadbc0abd9a2ed8f940a12c7f8d01d5";
        let editId = null, pathToDelete = '', movieViewMode = 'detailed', seriesViewMode = 'detailed';
        let allMovies = {}, allSeries = {}, allLive = {};

        // TMDB Genre Map for auto selection
        const tmdbGenreMap = {
            28: "Action", 12: "Adventure", 35: "Comedy", 27: "Horror", 10749: "Romance", 53: "Thriller", 18: "Drama", 878: "Sci-Fi",
            10759: "Action", 10765: "Sci-Fi" // TV Specific mappings
        };

        function showToast(msg) {
            const t = document.getElementById('custom-toast');
            t.innerHTML = `<i class="fas fa-check-circle"></i> <span>${msg}</span>`;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('overlay').style.display = document.getElementById('sidebar').classList.contains('open') ? 'block' : 'none';
        }

        function showSec(id, btn, isEdit = false) {
            document.querySelectorAll('.glass-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(btn) btn.classList.add('active');
            if(!isEdit && window.innerWidth < 1100) toggleMenu();
        }

        function toggleDropdown(id) { document.getElementById(id).classList.toggle('open'); }

        function selectOption(dropdownId, value) {
            const dropdown = document.getElementById(dropdownId);
            const prefix = dropdownId.startsWith('m-') ? 'm' : 's';
            document.getElementById(`${prefix}-cat-label`).innerText = value;
            document.getElementById(`${prefix}-cat`).value = value;
            dropdown.classList.remove('open');
        }

        function updatePreview(inputId, preId) {
            const url = document.getElementById(inputId).value;
            const box = document.getElementById(preId);
            if(url && url.startsWith('http')) { box.querySelector('img').src = url; box.style.display = 'block'; }
            else { box.style.display = 'none'; }
        }

        async function fetchTMDB(type) {
            const inputVal = document.getElementById(type === 'movie' ? 'm-title' : 's-title').value;
            if(!inputVal) return showToast("Title or ID is empty!");
            
            let url;
            // Check if input is a number (TMDb ID)
            if (/^\d+$/.test(inputVal)) {
                url = `https://api.themoviedb.org/3/${type === 'movie' ? 'movie' : 'tv'}/${inputVal}?api_key=${TMDB_API_KEY}`;
            } else {
                url = `https://api.themoviedb.org/3/search/${type === 'movie' ? 'movie' : 'tv'}?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(inputVal)}`;
            }

            try {
                const res = await fetch(url);
                const data = await res.json();
                
                let item;
                if(data.results) { // If it was a search result
                    if(data.results.length === 0) return showToast("No results found.");
                    item = data.results[0];
                } else { // If it was a direct ID fetch
                    item = data;
                }

                if(item.id) {
                    const pfx = type === 'movie' ? 'm' : 's';
                    const lang = item.original_language;

                    // Update Title input with the actual movie name
                    document.getElementById(`${pfx}-title`).value = item.title || item.name;
                    document.getElementById(`${pfx}-poster`).value = `https://image.tmdb.org/t/p/w500${item.poster_path}`;
                    document.getElementById(`${pfx}-backdrop`).value = `https://image.tmdb.org/t/p/original${item.backdrop_path}`;
                    
                    let autoCat = "";
                    if(type === 'movie') {
                        if(['ta', 'te', 'ml', 'kn'].includes(lang)) autoCat = "South Indian";
                        else if(lang === 'hi') autoCat = "Bollywood";
                        else if(lang === 'ko') autoCat = "Korean";
                        else if(lang === 'en') autoCat = "Hollywood";
                        else autoCat = "Hollywood"; 
                        
                        selectOption('m-cat-dropdown', autoCat);
                    } else {
                        if(lang === 'ko') autoCat = "K-Drama";
                        else if(lang === 'zh') autoCat = "C-Drama";
                        else if(lang === 'ja') autoCat = "Anime";
                        else autoCat = "Web Series";

                        selectOption('s-cat-dropdown', autoCat);
                    }

                    if(item.genre_ids || item.genres) {
                        const genresArr = item.genre_ids ? item.genre_ids : item.genres.map(g => g.id);
                        const matchedGenres = genresArr.map(id => tmdbGenreMap[id]).filter(g => g);
                        setSelectedGenres(`${pfx}-genres-list`, matchedGenres.join(', '));
                    }

                    updatePreview(`${pfx}-poster`, `${pfx}-poster-pre`); 
                    updatePreview(`${pfx}-backdrop`, `${pfx}-backdrop-pre`);
                    showToast(`Fetched: ${item.title || item.name}`);
                } else { showToast("No results found."); }
            } catch(e) { showToast("Error connecting to TMDB."); }
        }

        // Logic to update episode labels (Episode 1, Episode 2...)
        function updateEpNumbers() {
            const rows = document.querySelectorAll('.ep-row');
            rows.forEach((row, index) => {
                row.querySelector('.ep-num-text').innerText = `Episode ${index + 1}:`;
            });
        }

        function addEpField(val = "") {
            const container = document.getElementById('ep-list-admin');
            const epCount = container.querySelectorAll('.ep-row').length + 1;
            
            const div = document.createElement('div');
            div.className = 'form-group ep-row';
            div.style.marginBottom = '12px';
            div.innerHTML = `
                <label class="ep-num-text">Episode ${epCount}:</label>
                <div style="display:flex; gap:10px; align-items:center;">
                    <input type="text" class="ep-link-input" placeholder="Paste link (mp4/m3u8) here..." value="${val}" style="flex:1">
                    <button onclick="this.parentElement.parentElement.remove(); updateEpNumbers();" style="background:none; border:none; color:#ff4d4d; font-size:18px; cursor:pointer;">
                        <i class="fas fa-trash-can"></i>
                    </button>
                </div>`;
            container.appendChild(div);
        }

        function getSelectedGenres(id) {
            return Array.from(document.querySelectorAll(`#${id} input:checked`)).map(cb => cb.value).join(', ');
        }

        function setSelectedGenres(id, str) {
            const arr = str ? str.split(', ') : [];
            document.querySelectorAll(`#${id} input`).forEach(cb => {
                cb.checked = arr.includes(cb.value);
            });
        }

        function saveMovie() {
            const data = {
                title: document.getElementById('m-title').value,
                poster: document.getElementById('m-poster').value,
                backdrop: document.getElementById('m-backdrop').value,
                category: document.getElementById('m-cat').value,
                genre: getSelectedGenres('m-genres-list'),
                link: document.getElementById('m-link').value,
                timestamp: Date.now(),
                type: 'movie'
            };
            if(!data.title || !data.link) return showToast("Title & Link required!");
            if(editId) db.ref('movies/' + editId).update(data);
            else db.ref('movies').push(data);
            showToast("Movie Updated!");
            resetForms();
        }

        function saveSeries() {
            const eps = Array.from(document.querySelectorAll('.ep-link-input')).map(i => ({ link: i.value }));
            const data = {
                title: document.getElementById('s-title').value,
                poster: document.getElementById('s-poster').value,
                backdrop: document.getElementById('s-backdrop').value,
                category: document.getElementById('s-cat').value,
                genre: getSelectedGenres('s-genres-list'),
                episodes: eps,
                timestamp: Date.now(),
                type: 'series'
            };
            if(!data.title || eps.length === 0) return showToast("Required data missing!");
            if(editId) db.ref('webseries/' + editId).update(data);
            else db.ref('webseries').push(data);
            showToast("Series Updated!");
            resetForms();
        }

        function saveLive() {
            const data = { name: document.getElementById('l-name').value, logo: document.getElementById('l-logo').value, link: document.getElementById('l-link').value };
            if(!data.name || !data.link) return showToast("Required fields empty!");
            if(editId) db.ref('live_tv/' + editId).update(data);
            else db.ref('live_tv').push(data);
            showToast("Channel Saved!");
            resetForms();
        }

        function sendNotification() {
            const msg = document.getElementById('notif-msg').value;
            const dur = document.getElementById('notif-dur').value;
            if(!msg) return showToast("No message entered.");
            db.ref('app_notification').set({ msg, dur, time: Date.now() }).then(() => showToast("Push Alert Sent!"));
        }

        function saveSettings() {
            const data = { version: document.getElementById('app-v').value, telegram: document.getElementById('tg-link').value, maintenance: document.getElementById('app-maint').value };
            db.ref('app_config').set(data).then(() => showToast("Global Config Saved!"));
        }

        function resetForms() {
            editId = null;
            document.querySelectorAll('input').forEach(i => i.type === 'checkbox' ? i.checked = false : i.value = '');
            document.querySelectorAll('textarea').forEach(t => t.value = '');
            document.querySelectorAll('.preview-box').forEach(b => b.style.display = 'none');
            document.getElementById('ep-list-admin').innerHTML = '<label>Manage Episodes</label>';
            document.getElementById('m-btn').innerText = "Upload Movie";
            document.getElementById('s-btn').innerText = "Publish Web Series";
            document.getElementById('l-btn').innerText = "Add Channel";
            document.getElementById('m-cat-label').innerText = "Hollywood";
            document.getElementById('m-cat').value = "Hollywood";
            document.getElementById('s-cat-label').innerText = "Web Series";
            document.getElementById('s-cat').value = "Web Series";
        }

        db.ref('/').on('value', snap => {
            const val = snap.val() || {};
            allMovies = val.movies || {};
            allSeries = val.webseries || {};
            allLive = val.live_tv || {};
            
            document.getElementById('count-movies').innerText = Object.keys(allMovies).length;
            document.getElementById('count-series').innerText = Object.keys(allSeries).length;
            document.getElementById('count-live').innerText = Object.keys(allLive).length;
            
            renderItems('m-list', allMovies, 'movies', movieViewMode);
            renderItems('s-list', allSeries, 'webseries', seriesViewMode);
            renderItems('l-list', allLive, 'live_tv', 'compact');
            
            if(val.app_config) {
                document.getElementById('stat-version').innerText = val.app_config.version || "1.0";
                document.getElementById('app-v').value = val.app_config.version || "";
                document.getElementById('tg-link').value = val.app_config.telegram || "";
                document.getElementById('app-maint').value = val.app_config.maintenance || "false";
            }
        });

        function renderItems(target, data, path, mode) {
            const container = document.getElementById(target);
            container.className = `items-list-container list-${mode}`;
            let html = '';
            Object.keys(data).sort((a,b) => (data[b].timestamp || 0) - (data[a].timestamp || 0)).forEach(k => {
                const item = data[k];
                html += `
                <div class="item-row" data-title="${(item.title || item.name).toLowerCase()}">
                    <img src="${item.poster || item.logo}" class="item-thumb" onerror="this.src='https://via.placeholder.com/150'">
                    <div class="item-info-box">
                        <span class="item-title-text">${item.title || item.name}</span>
                        <span class="item-category-tag">${item.category || 'Live'}</span>
                        <div class="action-btns">
                            <button class="edit-btn" onclick="editData('${path}', '${k}')"><i class="fas fa-edit"></i></button>
                            <button class="del-btn" onclick="askDel('${path}/${k}')"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                </div>`;
            });
            container.innerHTML = html || '<p style="text-align:center; opacity:0.5; padding:20px;">Empty List</p>';
        }

        function filterList(targetId, query) {
            const q = query.toLowerCase();
            document.querySelectorAll(`#${targetId} .item-row`).forEach(row => {
                row.style.display = row.getAttribute('data-title').includes(q) ? 'flex' : 'none';
                if(targetId.includes('grid')) row.style.display = row.getAttribute('data-title').includes(q) ? 'block' : 'none';
            });
        }

        function switchView(mode, section) {
            if(section === 'movie') movieViewMode = mode; else seriesViewMode = mode;
            document.querySelectorAll(`#${section}-sec .view-tab`).forEach(t => t.classList.toggle('active', t.id.includes(mode)));
            renderItems(section === 'movie' ? 'm-list' : 's-list', section === 'movie' ? allMovies : allSeries, section === 'movie' ? 'movies' : 'webseries', mode);
        }

        function editData(path, id) {
            editId = id;
            db.ref(`${path}/${id}`).once('value', snap => {
                const item = snap.val();
                if(path === 'movies') {
                    showSec('movie-sec', null, true);
                    document.getElementById('m-title').value = item.title;
                    document.getElementById('m-poster').value = item.poster;
                    document.getElementById('m-backdrop').value = item.backdrop;
                    selectOption('m-cat-dropdown', item.category);
                    setSelectedGenres('m-genres-list', item.genre);
                    document.getElementById('m-link').value = item.link;
                    document.getElementById('m-btn').innerText = "Update Movie";
                    updatePreview('m-poster', 'm-poster-pre'); updatePreview('m-backdrop', 'm-backdrop-pre');
                } else if(path === 'webseries') {
                    showSec('series-sec', null, true);
                    document.getElementById('s-title').value = item.title;
                    document.getElementById('s-poster').value = item.poster;
                    document.getElementById('s-backdrop').value = item.backdrop;
                    selectOption('s-cat-dropdown', item.category);
                    setSelectedGenres('s-genres-list', item.genre);
                    document.getElementById('ep-list-admin').innerHTML = '<label>Manage Episodes</label>';
                    if(item.episodes) item.episodes.forEach(e => addEpField(e.link));
                    document.getElementById('s-btn').innerText = "Update Series";
                    updatePreview('s-poster', 's-poster-pre'); updatePreview('s-backdrop', 's-backdrop-pre');
                } else if(path === 'live_tv') {
                    showSec('live-sec', null, true);
                    document.getElementById('l-name').value = item.name;
                    document.getElementById('l-logo').value = item.logo;
                    document.getElementById('l-link').value = item.link;
                    document.getElementById('l-btn').innerText = "Update Channel";
                }
                window.scrollTo({top: 0, behavior: 'smooth'});
            });
        }

        function askDel(path) { pathToDelete = path; document.getElementById('delModal').style.display = 'flex'; }
        function closeDelModal() { document.getElementById('delModal').style.display = 'none'; }
        document.getElementById('confirmDelBtn').onclick = () => {
            db.ref(pathToDelete).remove().then(() => {
                showToast("Item Deleted.");
                closeDelModal();
            });
        };

        window.onclick = (e) => { if(!e.target.closest('.custom-dropdown')) document.querySelectorAll('.custom-dropdown').forEach(d => d.classList.remove('open')); };
    </script>
</body>
</html>